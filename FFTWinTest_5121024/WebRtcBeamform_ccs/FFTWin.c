// WebRtcAudioTest.cpp : Defines the entry point for the console application.
//
#include "stdafx.h"
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <math.h>
#include "myc.h"  
#include "dsplib.h"
#include "windows_private.h"
#include "signal_processing_library.h"
#define	NN 512
#define	NN2 512
#define	FRAMEL 1024	
#define	FFT_SIZE 1024
//#define  FILTER_SIZE  512
static const float kBlockswin[1024] = {
	0.00000000000000f, 0.00306795676297f, 0.00613588464916f, 0.00920375478206f, 0.01227153828572f, 0.01533920628499f, 0.01840672990580f, 0.02147408027547f, 0.02454122852291f,
	0.02760814577897f, 0.03067480317664f, 0.03374117185138f, 0.03680722294136f, 0.03987292758774f, 0.04293825693494f, 0.04600318213091f, 0.04906767432742f, 0.05213170468028f,
	0.05519524434969f, 0.05825826450044f, 0.06132073630221f, 0.06438263092986f, 0.06744391956366f, 0.07050457338961f, 0.07356456359967f, 0.07662386139203f, 0.07968243797143f,
	0.08274026454938f, 0.08579731234444f, 0.08885355258252f, 0.09190895649713f, 0.09496349532964f, 0.09801714032956f, 0.10106986275483f, 0.10412163387205f, 0.10717242495681f,
	0.11022220729388f, 0.11327095217756f, 0.11631863091190f, 0.11936521481099f, 0.12241067519922f, 0.12545498341155f, 0.12849811079379f, 0.13154002870288f, 0.13458070850713f,
	0.13762012158649f, 0.14065823933285f, 0.14369503315029f, 0.14673047445536f, 0.14976453467732f, 0.15279718525844f, 0.15582839765427f, 0.15885814333386f, 0.16188639378011f,
	0.16491312048997f, 0.16793829497473f, 0.17096188876030f, 0.17398387338746f, 0.17700422041215f, 0.18002290140570f, 0.18303988795514f, 0.18605515166345f, 0.18906866414981f,
	0.19208039704989f, 0.19509032201613f, 0.19809841071795f, 0.20110463484209f, 0.20410896609282f, 0.20711137619222f, 0.21011183688047f, 0.21311031991609f, 0.21610679707622f,
	0.21910124015687f, 0.22209362097320f, 0.22508391135979f, 0.22807208317089f, 0.23105810828067f, 0.23404195858354f, 0.23702360599437f, 0.24000302244874f, 0.24298017990326f,
	0.24595505033579f, 0.24892760574572f, 0.25189781815422f, 0.25486565960451f, 0.25783110216216f, 0.26079411791528f, 0.26375467897483f, 0.26671275747490f, 0.26966832557292f,
	0.27262135544995f, 0.27557181931096f, 0.27851968938505f, 0.28146493792576f, 0.28440753721127f, 0.28734745954473f, 0.29028467725446f, 0.29321916269426f, 0.29615088824362f,
	0.29907982630804f, 0.30200594931923f, 0.30492922973540f, 0.30784964004153f, 0.31076715274961f, 0.31368174039889f, 0.31659337555617f, 0.31950203081602f, 0.32240767880107f,
	0.32531029216226f, 0.32820984357909f, 0.33110630575988f, 0.33399965144201f, 0.33688985339222f, 0.33977688440683f, 0.34266071731199f, 0.34554132496399f, 0.34841868024943f,
	0.35129275608557f, 0.35416352542049f, 0.35703096123343f, 0.35989503653499f, 0.36275572436740f, 0.36561299780477f, 0.36846682995337f, 0.37131719395184f, 0.37416406297146f,
	0.37700741021642f, 0.37984720892405f, 0.38268343236509f, 0.38551605384392f, 0.38834504669883f, 0.39117038430225f, 0.39399204006105f, 0.39680998741671f, 0.39962419984565f,
	0.40243465085942f, 0.40524131400499f, 0.40804416286498f, 0.41084317105790f, 0.41363831223843f, 0.41642956009764f, 0.41921688836322f, 0.42200027079980f, 0.42477968120911f,
	0.42755509343028f, 0.43032648134008f, 0.43309381885315f, 0.43585707992226f, 0.43861623853853f, 0.44137126873172f, 0.44412214457043f, 0.44686884016237f, 0.44961132965461f,
	0.45234958723377f, 0.45508358712634f, 0.45781330359888f, 0.46053871095824f, 0.46325978355186f, 0.46597649576797f, 0.46868882203583f, 0.47139673682600f, 0.47410021465055f,
	0.47679923006332f, 0.47949375766015f, 0.48218377207912f, 0.48486924800079f, 0.48755016014844f, 0.49022648328829f, 0.49289819222978f, 0.49556526182577f, 0.49822766697278f,
	0.50088538261124f, 0.50353838372572f, 0.50618664534516f, 0.50883014254311f, 0.51146885043797f, 0.51410274419322f, 0.51673179901765f, 0.51935599016559f, 0.52197529293715f,
	0.52458968267847f, 0.52719913478190f, 0.52980362468629f, 0.53240312787720f, 0.53499761988710f, 0.53758707629565f, 0.54017147272989f, 0.54275078486452f, 0.54532498842205f,
	0.54789405917310f, 0.55045797293660f, 0.55301670558003f, 0.55557023301960f, 0.55811853122056f, 0.56066157619734f, 0.56319934401383f, 0.56573181078361f, 0.56825895267013f,
	0.57078074588697f, 0.57329716669804f, 0.57580819141785f, 0.57831379641166f, 0.58081395809576f, 0.58330865293770f, 0.58579785745644f, 0.58828154822265f, 0.59075970185887f,
	0.59323229503980f, 0.59569930449243f, 0.59816070699634f, 0.60061647938387f, 0.60306659854035f, 0.60551104140433f, 0.60794978496777f, 0.61038280627631f, 0.61281008242941f,
	0.61523159058063f, 0.61764730793780f, 0.62005721176329f, 0.62246127937415f, 0.62485948814239f, 0.62725181549514f, 0.62963823891493f, 0.63201873593981f, 0.63439328416365f,
	0.63676186123628f, 0.63912444486378f, 0.64148101280858f, 0.64383154288979f, 0.64617601298332f, 0.64851440102211f, 0.65084668499638f, 0.65317284295378f, 0.65549285299962f,
	0.65780669329708f, 0.66011434206742f, 0.66241577759017f, 0.66471097820334f, 0.66699992230364f, 0.66928258834664f, 0.67155895484702f, 0.67382900037876f, 0.67609270357532f,
	0.67835004312986f, 0.68060099779545f, 0.68284554638525f, 0.68508366777270f, 0.68731534089176f, 0.68954054473707f, 0.69175925836416f, 0.69397146088965f, 0.69617713149146f,
	0.69837624940897f, 0.70056879394325f, 0.70275474445723f, 0.70493408037590f, 0.70710678118655f, 0.70927282643887f, 0.71143219574522f, 0.71358486878079f, 0.71573082528382f,
	0.71787004505573f, 0.72000250796138f, 0.72212819392922f, 0.72424708295147f, 0.72635915508435f, 0.72846439044823f, 0.73056276922783f, 0.73265427167241f, 0.73473887809596f,
	0.73681656887737f, 0.73888732446062f, 0.74095112535496f, 0.74300795213512f, 0.74505778544147f, 0.74710060598018f, 0.74913639452346f, 0.75116513190969f, 0.75318679904361f,
	0.75520137689654f, 0.75720884650648f, 0.75920918897839f, 0.76120238548426f, 0.76318841726338f, 0.76516726562246f, 0.76713891193582f, 0.76910333764558f, 0.77106052426181f,
	0.77301045336274f, 0.77495310659487f, 0.77688846567323f, 0.77881651238148f, 0.78073722857209f, 0.78265059616658f, 0.78455659715558f, 0.78645521359909f, 0.78834642762661f,
	0.79023022143731f, 0.79210657730021f, 0.79397547755434f, 0.79583690460888f, 0.79769084094339f, 0.79953726910791f, 0.80137617172314f, 0.80320753148064f, 0.80503133114296f,
	0.80684755354380f, 0.80865618158817f, 0.81045719825259f, 0.81225058658520f, 0.81403632970595f, 0.81581441080673f, 0.81758481315158f, 0.81934752007680f, 0.82110251499110f,
	0.82284978137583f, 0.82458930278503f, 0.82632106284566f, 0.82804504525776f, 0.82976123379452f, 0.83146961230255f, 0.83317016470191f, 0.83486287498638f, 0.83654772722351f,
	0.83822470555484f, 0.83989379419600f, 0.84155497743690f, 0.84320823964185f, 0.84485356524971f, 0.84649093877405f, 0.84812034480330f, 0.84974176800085f, 0.85135519310527f,
	0.85296060493036f, 0.85455798836540f, 0.85614732837519f, 0.85772861000027f, 0.85930181835701f, 0.86086693863777f, 0.86242395611104f, 0.86397285612159f, 0.86551362409057f,
	0.86704624551569f, 0.86857070597134f, 0.87008699110871f, 0.87159508665595f, 0.87309497841829f, 0.87458665227818f, 0.87607009419541f, 0.87754529020726f, 0.87901222642863f,
	0.88047088905216f, 0.88192126434835f, 0.88336333866573f, 0.88479709843094f, 0.88622253014888f, 0.88763962040285f, 0.88904835585466f, 0.89044872324476f, 0.89184070939234f,
	0.89322430119552f, 0.89459948563138f, 0.89596624975619f, 0.89732458070542f, 0.89867446569395f, 0.90001589201616f, 0.90134884704602f, 0.90267331823726f, 0.90398929312344f,
	0.90529675931812f, 0.90659570451492f, 0.90788611648767f, 0.90916798309052f, 0.91044129225807f, 0.91170603200543f, 0.91296219042840f, 0.91420975570353f, 0.91544871608827f,
	0.91667905992104f, 0.91790077562139f, 0.91911385169006f, 0.92031827670911f, 0.92151403934204f, 0.92270112833388f, 0.92387953251129f, 0.92504924078268f, 0.92621024213831f,
	0.92736252565040f, 0.92850608047322f, 0.92964089584318f, 0.93076696107898f, 0.93188426558167f, 0.93299279883474f, 0.93409255040426f, 0.93518350993895f, 0.93626566717028f,
	0.93733901191257f, 0.93840353406311f, 0.93945922360219f, 0.94050607059327f, 0.94154406518302f, 0.94257319760145f, 0.94359345816196f, 0.94460483726148f, 0.94560732538052f,
	0.94660091308328f, 0.94758559101774f, 0.94856134991573f, 0.94952818059304f, 0.95048607394948f, 0.95143502096901f, 0.95237501271977f, 0.95330604035419f, 0.95422809510911f,
	0.95514116830577f, 0.95604525135000f, 0.95694033573221f, 0.95782641302753f, 0.95870347489587f, 0.95957151308198f, 0.96043051941557f, 0.96128048581132f, 0.96212140426904f,
	0.96295326687368f, 0.96377606579544f, 0.96458979328981f, 0.96539444169769f, 0.96619000344541f, 0.96697647104485f, 0.96775383709348f, 0.96852209427442f, 0.96928123535655f,
	0.97003125319454f, 0.97077214072895f, 0.97150389098625f, 0.97222649707894f, 0.97293995220556f, 0.97364424965081f, 0.97433938278558f, 0.97502534506699f, 0.97570213003853f,
	0.97636973133002f, 0.97702814265775f, 0.97767735782451f, 0.97831737071963f, 0.97894817531906f, 0.97956976568544f, 0.98018213596812f, 0.98078528040323f, 0.98137919331375f,
	0.98196386910956f, 0.98253930228744f, 0.98310548743122f, 0.98366241921173f, 0.98421009238693f, 0.98474850180190f, 0.98527764238894f, 0.98579750916757f, 0.98630809724460f,
	0.98680940181419f, 0.98730141815786f, 0.98778414164457f, 0.98825756773075f, 0.98872169196032f, 0.98917650996478f, 0.98962201746320f, 0.99005821026230f, 0.99048508425646f,
	0.99090263542778f, 0.99131085984612f, 0.99170975366910f, 0.99209931314219f, 0.99247953459871f, 0.99285041445987f, 0.99321194923479f, 0.99356413552060f, 0.99390697000236f,
	0.99424044945319f, 0.99456457073426f, 0.99487933079481f, 0.99518472667220f, 0.99548075549193f, 0.99576741446766f, 0.99604470090125f, 0.99631261218278f, 0.99657114579055f,
	0.99682029929117f, 0.99706007033948f, 0.99729045667869f, 0.99751145614030f, 0.99772306664419f, 0.99792528619860f, 0.99811811290015f, 0.99830154493389f, 0.99847558057329f,
	0.99864021818027f, 0.99879545620517f, 0.99894129318686f, 0.99907772775265f, 0.99920475861836f, 0.99932238458835f, 0.99943060455546f, 0.99952941750109f, 0.99961882249518f,
	0.99969881869620f, 0.99976940535122f, 0.99983058179582f, 0.99988234745421f, 0.99992470183914f, 0.99995764455196f, 0.99998117528260f, 0.99999529380958f, 1.00000000000000f,
	0.99999529380958f, 0.99998117528260f, 0.99995764455196f, 0.99992470183914f, 0.99988234745421f, 0.99983058179582f, 0.99976940535122f, 0.99969881869620f, 0.99961882249518f,
	0.99952941750109f, 0.99943060455546f, 0.99932238458835f, 0.99920475861836f, 0.99907772775265f, 0.99894129318686f, 0.99879545620517f, 0.99864021818027f, 0.99847558057329f,
	0.99830154493389f, 0.99811811290015f, 0.99792528619860f, 0.99772306664419f, 0.99751145614030f, 0.99729045667869f, 0.99706007033948f, 0.99682029929117f, 0.99657114579055f,
	0.99631261218278f, 0.99604470090125f, 0.99576741446766f, 0.99548075549193f, 0.99518472667220f, 0.99487933079481f, 0.99456457073426f, 0.99424044945319f, 0.99390697000236f,
	0.99356413552060f, 0.99321194923479f, 0.99285041445987f, 0.99247953459871f, 0.99209931314219f, 0.99170975366910f, 0.99131085984612f, 0.99090263542778f, 0.99048508425646f,
	0.99005821026230f, 0.98962201746320f, 0.98917650996478f, 0.98872169196032f, 0.98825756773075f, 0.98778414164457f, 0.98730141815786f, 0.98680940181419f, 0.98630809724460f,
	0.98579750916757f, 0.98527764238894f, 0.98474850180190f, 0.98421009238693f, 0.98366241921173f, 0.98310548743122f, 0.98253930228744f, 0.98196386910956f, 0.98137919331375f,
	0.98078528040323f, 0.98018213596812f, 0.97956976568544f, 0.97894817531906f, 0.97831737071963f, 0.97767735782451f, 0.97702814265775f, 0.97636973133002f, 0.97570213003853f,
	0.97502534506699f, 0.97433938278558f, 0.97364424965081f, 0.97293995220556f, 0.97222649707894f, 0.97150389098625f, 0.97077214072895f, 0.97003125319454f, 0.96928123535655f,
	0.96852209427442f, 0.96775383709348f, 0.96697647104485f, 0.96619000344541f, 0.96539444169769f, 0.96458979328981f, 0.96377606579544f, 0.96295326687368f, 0.96212140426904f,
	0.96128048581132f, 0.96043051941557f, 0.95957151308198f, 0.95870347489587f, 0.95782641302753f, 0.95694033573221f, 0.95604525135000f, 0.95514116830577f, 0.95422809510911f,
	0.95330604035419f, 0.95237501271977f, 0.95143502096901f, 0.95048607394948f, 0.94952818059304f, 0.94856134991573f, 0.94758559101774f, 0.94660091308328f, 0.94560732538052f,
	0.94460483726148f, 0.94359345816196f, 0.94257319760145f, 0.94154406518302f, 0.94050607059327f, 0.93945922360219f, 0.93840353406311f, 0.93733901191257f, 0.93626566717028f,
	0.93518350993895f, 0.93409255040426f, 0.93299279883474f, 0.93188426558167f, 0.93076696107898f, 0.92964089584318f, 0.92850608047322f, 0.92736252565040f, 0.92621024213831f,
	0.92504924078268f, 0.92387953251129f, 0.92270112833388f, 0.92151403934204f, 0.92031827670911f, 0.91911385169006f, 0.91790077562139f, 0.91667905992104f, 0.91544871608827f,
	0.91420975570353f, 0.91296219042840f, 0.91170603200543f, 0.91044129225807f, 0.90916798309052f, 0.90788611648767f, 0.90659570451492f, 0.90529675931812f, 0.90398929312344f,
	0.90267331823726f, 0.90134884704602f, 0.90001589201616f, 0.89867446569395f, 0.89732458070542f, 0.89596624975619f, 0.89459948563138f, 0.89322430119552f, 0.89184070939234f,
	0.89044872324476f, 0.88904835585466f, 0.88763962040285f, 0.88622253014888f, 0.88479709843094f, 0.88336333866573f, 0.88192126434835f, 0.88047088905216f, 0.87901222642863f,
	0.87754529020726f, 0.87607009419541f, 0.87458665227818f, 0.87309497841829f, 0.87159508665595f, 0.87008699110871f, 0.86857070597134f, 0.86704624551569f, 0.86551362409057f,
	0.86397285612159f, 0.86242395611104f, 0.86086693863777f, 0.85930181835701f, 0.85772861000027f, 0.85614732837519f, 0.85455798836540f, 0.85296060493036f, 0.85135519310527f,
	0.84974176800085f, 0.84812034480330f, 0.84649093877405f, 0.84485356524971f, 0.84320823964185f, 0.84155497743690f, 0.83989379419600f, 0.83822470555484f, 0.83654772722351f,
	0.83486287498638f, 0.83317016470191f, 0.83146961230255f, 0.82976123379452f, 0.82804504525776f, 0.82632106284566f, 0.82458930278503f, 0.82284978137583f, 0.82110251499110f,
	0.81934752007680f, 0.81758481315158f, 0.81581441080673f, 0.81403632970595f, 0.81225058658520f, 0.81045719825259f, 0.80865618158817f, 0.80684755354380f, 0.80503133114296f,
	0.80320753148064f, 0.80137617172314f, 0.79953726910791f, 0.79769084094339f, 0.79583690460888f, 0.79397547755434f, 0.79210657730021f, 0.79023022143731f, 0.78834642762661f,
	0.78645521359909f, 0.78455659715558f, 0.78265059616658f, 0.78073722857209f, 0.77881651238148f, 0.77688846567323f, 0.77495310659487f, 0.77301045336274f, 0.77106052426181f,
	0.76910333764558f, 0.76713891193582f, 0.76516726562246f, 0.76318841726338f, 0.76120238548426f, 0.75920918897839f, 0.75720884650648f, 0.75520137689654f, 0.75318679904361f,
	0.75116513190969f, 0.74913639452346f, 0.74710060598018f, 0.74505778544147f, 0.74300795213512f, 0.74095112535496f, 0.73888732446062f, 0.73681656887737f, 0.73473887809596f,
	0.73265427167241f, 0.73056276922783f, 0.72846439044823f, 0.72635915508435f, 0.72424708295147f, 0.72212819392922f, 0.72000250796138f, 0.71787004505573f, 0.71573082528382f,
	0.71358486878079f, 0.71143219574522f, 0.70927282643887f, 0.70710678118655f, 0.70493408037590f, 0.70275474445723f, 0.70056879394325f, 0.69837624940897f, 0.69617713149146f,
	0.69397146088965f, 0.69175925836416f, 0.68954054473707f, 0.68731534089176f, 0.68508366777270f, 0.68284554638525f, 0.68060099779545f, 0.67835004312986f, 0.67609270357532f,
	0.67382900037876f, 0.67155895484702f, 0.66928258834664f, 0.66699992230364f, 0.66471097820334f, 0.66241577759017f, 0.66011434206742f, 0.65780669329708f, 0.65549285299962f,
	0.65317284295378f, 0.65084668499638f, 0.64851440102211f, 0.64617601298332f, 0.64383154288979f, 0.64148101280858f, 0.63912444486378f, 0.63676186123628f, 0.63439328416365f,
	0.63201873593981f, 0.62963823891493f, 0.62725181549514f, 0.62485948814239f, 0.62246127937415f, 0.62005721176329f, 0.61764730793780f, 0.61523159058063f, 0.61281008242941f,
	0.61038280627631f, 0.60794978496777f, 0.60551104140433f, 0.60306659854035f, 0.60061647938387f, 0.59816070699634f, 0.59569930449243f, 0.59323229503980f, 0.59075970185887f,
	0.58828154822265f, 0.58579785745644f, 0.58330865293770f, 0.58081395809576f, 0.57831379641166f, 0.57580819141785f, 0.57329716669804f, 0.57078074588697f, 0.56825895267013f,
	0.56573181078361f, 0.56319934401383f, 0.56066157619734f, 0.55811853122056f, 0.55557023301960f, 0.55301670558003f, 0.55045797293660f, 0.54789405917310f, 0.54532498842205f,
	0.54275078486452f, 0.54017147272989f, 0.53758707629565f, 0.53499761988710f, 0.53240312787720f, 0.52980362468629f, 0.52719913478190f, 0.52458968267847f, 0.52197529293715f,
	0.51935599016559f, 0.51673179901765f, 0.51410274419322f, 0.51146885043797f, 0.50883014254311f, 0.50618664534516f, 0.50353838372572f, 0.50088538261124f, 0.49822766697278f,
	0.49556526182577f, 0.49289819222978f, 0.49022648328829f, 0.48755016014844f, 0.48486924800079f, 0.48218377207912f, 0.47949375766015f, 0.47679923006332f, 0.47410021465055f,
	0.47139673682600f, 0.46868882203583f, 0.46597649576797f, 0.46325978355186f, 0.46053871095824f, 0.45781330359888f, 0.45508358712634f, 0.45234958723377f, 0.44961132965461f,
	0.44686884016237f, 0.44412214457043f, 0.44137126873172f, 0.43861623853853f, 0.43585707992226f, 0.43309381885315f, 0.43032648134008f, 0.42755509343028f, 0.42477968120911f,
	0.42200027079980f, 0.41921688836322f, 0.41642956009764f, 0.41363831223843f, 0.41084317105790f, 0.40804416286498f, 0.40524131400499f, 0.40243465085942f, 0.39962419984565f,
	0.39680998741671f, 0.39399204006105f, 0.39117038430225f, 0.38834504669883f, 0.38551605384392f, 0.38268343236509f, 0.37984720892405f, 0.37700741021642f, 0.37416406297146f,
	0.37131719395184f, 0.36846682995337f, 0.36561299780477f, 0.36275572436740f, 0.35989503653499f, 0.35703096123343f, 0.35416352542049f, 0.35129275608557f, 0.34841868024943f,
	0.34554132496399f, 0.34266071731199f, 0.33977688440683f, 0.33688985339222f, 0.33399965144201f, 0.33110630575988f, 0.32820984357909f, 0.32531029216226f, 0.32240767880107f,
	0.31950203081602f, 0.31659337555617f, 0.31368174039889f, 0.31076715274961f, 0.30784964004153f, 0.30492922973540f, 0.30200594931923f, 0.29907982630804f, 0.29615088824362f,
	0.29321916269426f, 0.29028467725446f, 0.28734745954473f, 0.28440753721127f, 0.28146493792576f, 0.27851968938505f, 0.27557181931096f, 0.27262135544995f, 0.26966832557292f,
	0.26671275747490f, 0.26375467897483f, 0.26079411791528f, 0.25783110216216f, 0.25486565960451f, 0.25189781815422f, 0.24892760574572f, 0.24595505033579f, 0.24298017990326f,
	0.24000302244874f, 0.23702360599437f, 0.23404195858354f, 0.23105810828067f, 0.22807208317089f, 0.22508391135979f, 0.22209362097320f, 0.21910124015687f, 0.21610679707622f,
	0.21311031991609f, 0.21011183688047f, 0.20711137619222f, 0.20410896609282f, 0.20110463484209f, 0.19809841071795f, 0.19509032201613f, 0.19208039704989f, 0.18906866414981f,
	0.18605515166345f, 0.18303988795514f, 0.18002290140570f, 0.17700422041215f, 0.17398387338746f, 0.17096188876030f, 0.16793829497473f, 0.16491312048997f, 0.16188639378011f,
	0.15885814333386f, 0.15582839765427f, 0.15279718525844f, 0.14976453467732f, 0.14673047445536f, 0.14369503315029f, 0.14065823933285f, 0.13762012158649f, 0.13458070850713f,
	0.13154002870288f, 0.12849811079379f, 0.12545498341155f, 0.12241067519922f, 0.11936521481099f, 0.11631863091190f, 0.11327095217756f, 0.11022220729388f, 0.10717242495681f,
	0.10412163387205f, 0.10106986275483f, 0.09801714032956f, 0.09496349532964f, 0.09190895649713f, 0.08885355258252f, 0.08579731234444f, 0.08274026454938f, 0.07968243797143f,
	0.07662386139203f, 0.07356456359967f, 0.07050457338961f, 0.06744391956366f, 0.06438263092986f, 0.06132073630221f, 0.05825826450044f, 0.05519524434969f, 0.05213170468028f,
	0.04906767432742f, 0.04600318213091f, 0.04293825693494f, 0.03987292758774f, 0.03680722294136f, 0.03374117185138f, 0.03067480317664f, 0.02760814577897f, 0.02454122852291f,
	0.02147408027547f, 0.01840672990580f, 0.01533920628499f, 0.01227153828572f, 0.00920375478206f, 0.00613588464916f, 0.00306795676297f };
unsigned char brev[64] =
{
	0x0, 0x20, 0x10, 0x30, 0x8, 0x28, 0x18, 0x38,
	0x4, 0x24, 0x14, 0x34, 0xc, 0x2c, 0x1c, 0x3c,
	0x2, 0x22, 0x12, 0x32, 0xa, 0x2a, 0x1a, 0x3a,
	0x6, 0x26, 0x16, 0x36, 0xe, 0x2e, 0x1e, 0x3e,
	0x1, 0x21, 0x11, 0x31, 0x9, 0x29, 0x19, 0x39,
	0x5, 0x25, 0x15, 0x35, 0xd, 0x2d, 0x1d, 0x3d,
	0x3, 0x23, 0x13, 0x33, 0xb, 0x2b, 0x1b, 0x3b,
	0x7, 0x27, 0x17, 0x37, 0xf, 0x2f, 0x1f, 0x3f
};

//512µ„FFT
static float Cwns[2048] = { 1.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 0.999981165f, 0.006135885f, 0.999924719f, 0.012271538f, 0.999830604f, 0.01840673f, 0.999924719f, 0.012271538f, 0.999698818f, 0.024541229f, 0.999322355f, 0.036807224f, 0.999830604f, 0.01840673f, 0.999322355f, 0.036807224f, 0.998475552f, 0.055195246f, 0.999698818f, 0.024541229f, 0.99879545f, 0.049067676f, 0.997290432f, 0.073564567f, 0.999529421f, 0.030674804f, 0.998118103f, 0.061320737f, 0.995767415f, 0.091908954f, 0.999322355f, 0.036807224f, 0.997290432f, 0.073564567f, 0.993906975f, 0.110222206f, 0.999077737f, 0.042938259f, 0.996312618f, 0.08579731f, 0.991709769f, 0.128498107f, 0.99879545f, 0.049067676f, 0.99518472f, 0.098017141f, 0.989176512f, 0.146730468f, 0.998475552f, 0.055195246f, 0.993906975f, 0.110222206f, 0.986308098f, 0.164913118f, 0.998118103f, 0.061320737f, 0.992479563f, 0.122410677f, 0.983105481f, 0.183039889f, 0.997723043f, 0.067443922f, 0.990902662f, 0.134580702f, 0.979569793f, 0.201104641f, 0.997290432f, 0.073564567f, 0.989176512f, 0.146730468f, 0.975702107f, 0.219101235f, 0.996820271f, 0.07968244f, 0.987301409f, 0.15885815f, 0.971503913f, 0.237023607f, 0.996312618f, 0.08579731f, 0.985277653f, 0.170961887f, 0.966976464f, 0.254865646f, 0.995767415f, 0.091908954f, 0.983105481f, 0.183039889f, 0.962121427f, 0.272621363f, 0.99518472f, 0.098017141f, 0.980785251f, 0.195090324f, 0.956940353f, 0.290284663f, 0.994564593f, 0.104121633f, 0.97831738f, 0.207111374f, 0.95143503f, 0.307849646f, 0.993906975f, 0.110222206f, 0.975702107f, 0.219101235f, 0.945607305f, 0.32531029f, 0.993211925f, 0.116318628f, 0.972939968f, 0.231058106f, 0.939459205f, 0.342660725f, 0.992479563f, 0.122410677f, 0.970031261f, 0.242980182f, 0.932992816f, 0.359895051f, 0.991709769f, 0.128498107f, 0.966976464f, 0.254865646f, 0.926210225f, 0.377007425f, 0.990902662f, 0.134580702f, 0.963776052f, 0.266712755f, 0.919113874f, 0.393992037f, 0.990058184f, 0.140658244f, 0.960430503f, 0.27851969f, 0.91170603f, 0.410843164f, 0.989176512f, 0.146730468f, 0.956940353f, 0.290284663f, 0.903989315f, 0.427555084f, 0.988257587f, 0.152797192f, 0.953306019f, 0.302005947f, 0.895966232f, 0.444122136f, 0.987301409f, 0.15885815f, 0.949528158f, 0.313681751f, 0.887639642f, 0.460538715f, 0.986308098f, 0.164913118f, 0.945607305f, 0.32531029f, 0.879012227f, 0.47679922f, 0.985277653f, 0.170961887f, 0.941544056f, 0.336889863f, 0.870086968f, 0.492898196f, 0.984210074f, 0.177004218f, 0.937339008f, 0.348418683f, 0.860866964f, 0.50883013f, 0.983105481f, 0.183039889f, 0.932992816f, 0.359895051f, 0.851355195f, 0.524589658f, 0.981963873f, 0.18906866f, 0.928506076f, 0.371317208f, 0.841554999f, 0.540171444f, 0.980785251f, 0.195090324f, 0.923879504f, 0.382683426f, 0.831469595f, 0.555570245f, 0.979569793f, 0.201104641f, 0.919113874f, 0.393992037f, 0.8211025f, 0.570780754f, 0.97831738f, 0.207111374f, 0.914209783f, 0.405241311f, 0.81045717f, 0.585797846f, 0.977028131f, 0.213110313f, 0.909168005f, 0.416429549f, 0.799537241f, 0.600616455f, 0.975702107f, 0.219101235f, 0.903989315f, 0.427555084f, 0.78834641f, 0.615231574f, 0.974339366f, 0.225083917f, 0.898674488f, 0.438616246f, 0.77688849f, 0.629638255f, 0.972939968f, 0.231058106f, 0.893224299f, 0.449611336f, 0.765167236f, 0.643831551f, 0.971503913f, 0.237023607f, 0.887639642f, 0.460538715f, 0.753186822f, 0.657806695f, 0.970031261f, 0.242980182f, 0.881921291f, 0.471396744f, 0.740951121f, 0.671558976f, 0.968522072f, 0.248927608f, 0.876070082f, 0.482183784f, 0.728464365f, 0.685083687f, 0.966976464f, 0.254865646f, 0.870086968f, 0.492898196f, 0.715730846f, 0.698376238f, 0.965394437f, 0.260794103f, 0.863972843f, 0.50353837f, 0.702754736f, 0.711432219f, 0.963776052f, 0.266712755f, 0.857728601f, 0.514102757f, 0.689540565f, 0.724247098f, 0.962121427f, 0.272621363f, 0.851355195f, 0.524589658f, 0.676092684f, 0.736816585f, 0.960430503f, 0.27851969f, 0.84485358f, 0.534997642f, 0.662415802f, 0.749136388f, 0.958703458f, 0.284407526f, 0.838224709f, 0.545324981f, 0.64851439f, 0.761202395f, 0.956940353f, 0.290284663f, 0.831469595f, 0.555570245f, 0.634393275f, 0.773010433f, 0.955141187f, 0.296150893f, 0.824589312f, 0.565731823f, 0.620057225f, 0.784556568f, 0.953306019f, 0.302005947f, 0.817584813f, 0.575808167f, 0.605511069f, 0.795836926f, 0.95143503f, 0.307849646f, 0.81045717f, 0.585797846f, 0.590759695f, 0.806847572f, 0.949528158f, 0.313681751f, 0.803207517f, 0.59569931f, 0.575808167f, 0.817584813f, 0.947585583f, 0.319502026f, 0.795836926f, 0.605511069f, 0.560661554f, 0.82804507f, 0.945607305f, 0.32531029f, 0.78834641f, 0.615231574f, 0.545324981f, 0.838224709f, 0.943593442f, 0.331106305f, 0.780737221f, 0.624859512f, 0.529803634f, 0.848120332f, 0.941544056f, 0.336889863f, 0.773010433f, 0.634393275f, 0.514102757f, 0.857728601f, 0.939459205f, 0.342660725f, 0.765167236f, 0.643831551f, 0.498227656f, 0.867046237f, 0.937339008f, 0.348418683f, 0.757208824f, 0.653172851f, 0.482183784f, 0.876070082f, 0.935183525f, 0.354163527f, 0.749136388f, 0.662415802f, 0.465976506f, 0.884797096f, 0.932992816f, 0.359895051f, 0.740951121f, 0.671558976f, 0.449611336f, 0.893224299f, 0.93076694f, 0.365612984f, 0.732654274f, 0.680601001f, 0.433093816f, 0.901348829f, 0.928506076f, 0.371317208f, 0.724247098f, 0.689540565f, 0.416429549f, 0.909168005f, 0.926210225f, 0.377007425f, 0.715730846f, 0.698376238f, 0.399624199f, 0.916679084f, 0.923879504f, 0.382683426f, 0.707106769f, 0.707106769f, 0.382683426f, 0.923879504f, 0.921514034f, 0.388345033f, 0.698376238f, 0.715730846f, 0.365612984f, 0.93076694f, 0.919113874f, 0.393992037f, 0.689540565f, 0.724247098f, 0.348418683f, 0.937339008f, 0.916679084f, 0.399624199f, 0.680601001f, 0.732654274f, 0.331106305f, 0.943593442f, 0.914209783f, 0.405241311f, 0.671558976f, 0.740951121f, 0.313681751f, 0.949528158f, 0.91170603f, 0.410843164f, 0.662415802f, 0.749136388f, 0.296150893f, 0.955141187f, 0.909168005f, 0.416429549f, 0.653172851f, 0.757208824f, 0.27851969f, 0.960430503f, 0.906595707f, 0.422000259f, 0.643831551f, 0.765167236f, 0.260794103f, 0.965394437f, 0.903989315f, 0.427555084f, 0.634393275f, 0.773010433f, 0.242980182f, 0.970031261f, 0.901348829f, 0.433093816f, 0.624859512f, 0.780737221f, 0.225083917f, 0.974339366f, 0.898674488f, 0.438616246f, 0.615231574f, 0.78834641f, 0.207111374f, 0.97831738f, 0.895966232f, 0.444122136f, 0.605511069f, 0.795836926f, 0.18906866f, 0.981963873f, 0.893224299f, 0.449611336f, 0.59569931f, 0.803207517f, 0.170961887f, 0.985277653f, 0.890448749f, 0.455083579f, 0.585797846f, 0.81045717f, 0.152797192f, 0.988257587f, 0.887639642f, 0.460538715f, 0.575808167f, 0.817584813f, 0.134580702f, 0.990902662f, 0.884797096f, 0.465976506f, 0.565731823f, 0.824589312f, 0.116318628f, 0.993211925f, 0.881921291f, 0.471396744f, 0.555570245f, 0.831469595f, 0.098017141f, 0.99518472f, 0.879012227f, 0.47679922f, 0.545324981f, 0.838224709f, 0.07968244f, 0.996820271f, 0.876070082f, 0.482183784f, 0.534997642f, 0.84485358f, 0.061320737f, 0.998118103f, 0.873094976f, 0.487550169f, 0.524589658f, 0.851355195f, 0.042938259f, 0.999077737f, 0.870086968f, 0.492898196f, 0.514102757f, 0.857728601f, 0.024541229f, 0.999698818f, 0.867046237f, 0.498227656f, 0.50353837f, 0.863972843f, 0.006135885f, 0.999981165f, 0.863972843f, 0.50353837f, 0.492898196f, 0.870086968f, -0.012271538f, 0.999924719f, 0.860866964f, 0.50883013f, 0.482183784f, 0.876070082f, -0.030674804f, 0.999529421f, 0.857728601f, 0.514102757f, 0.471396744f, 0.881921291f, -0.049067676f, 0.99879545f, 0.854557991f, 0.519356012f, 0.460538715f, 0.887639642f, -0.067443922f, 0.997723043f, 0.851355195f, 0.524589658f, 0.449611336f, 0.893224299f, -0.08579731f, 0.996312618f, 0.848120332f, 0.529803634f, 0.438616246f, 0.898674488f, -0.104121633f, 0.994564593f, 0.84485358f, 0.534997642f, 0.427555084f, 0.903989315f, -0.122410677f, 0.992479563f, 0.841554999f, 0.540171444f, 0.416429549f, 0.909168005f, -0.140658244f, 0.990058184f, 0.838224709f, 0.545324981f, 0.405241311f, 0.914209783f, -0.15885815f, 0.987301409f, 0.834862888f, 0.550457954f, 0.393992037f, 0.919113874f, -0.177004218f, 0.984210074f, 0.831469595f, 0.555570245f, 0.382683426f, 0.923879504f, -0.195090324f, 0.980785251f, 0.82804507f, 0.560661554f, 0.371317208f, 0.928506076f, -0.213110313f, 0.977028131f, 0.824589312f, 0.565731823f, 0.359895051f, 0.932992816f, -0.231058106f, 0.972939968f, 0.8211025f, 0.570780754f, 0.348418683f, 0.937339008f, -0.248927608f, 0.968522072f, 0.817584813f, 0.575808167f, 0.336889863f, 0.941544056f, -0.266712755f, 0.963776052f, 0.81403631f, 0.580813944f, 0.32531029f, 0.945607305f, -0.284407526f, 0.958703458f, 0.81045717f, 0.585797846f, 0.313681751f, 0.949528158f, -0.302005947f, 0.953306019f, 0.806847572f, 0.590759695f, 0.302005947f, 0.953306019f, -0.319502026f, 0.947585583f, 0.803207517f, 0.59569931f, 0.290284663f, 0.956940353f, -0.336889863f, 0.941544056f, 0.799537241f, 0.600616455f, 0.27851969f, 0.960430503f, -0.354163527f, 0.935183525f, 0.795836926f, 0.605511069f, 0.266712755f, 0.963776052f, -0.371317208f, 0.928506076f, 0.792106569f, 0.610382795f, 0.254865646f, 0.966976464f, -0.388345033f, 0.921514034f, 0.78834641f, 0.615231574f, 0.242980182f, 0.970031261f, -0.405241311f, 0.914209783f, 0.784556568f, 0.620057225f, 0.231058106f, 0.972939968f, -0.422000259f, 0.906595707f, 0.780737221f, 0.624859512f, 0.219101235f, 0.975702107f, -0.438616246f, 0.898674488f, 0.77688849f, 0.629638255f, 0.207111374f, 0.97831738f, -0.455083579f, 0.890448749f, 0.773010433f, 0.634393275f, 0.195090324f, 0.980785251f, -0.471396744f, 0.881921291f, 0.769103348f, 0.639124453f, 0.183039889f, 0.983105481f, -0.487550169f, 0.873094976f, 0.765167236f, 0.643831551f, 0.170961887f, 0.985277653f, -0.50353837f, 0.863972843f, 0.761202395f, 0.64851439f, 0.15885815f, 0.987301409f, -0.519356012f, 0.854557991f, 0.757208824f, 0.653172851f, 0.146730468f, 0.989176512f, -0.534997642f, 0.84485358f, 0.753186822f, 0.657806695f, 0.134580702f, 0.990902662f, -0.550457954f, 0.834862888f, 0.749136388f, 0.662415802f, 0.122410677f, 0.992479563f, -0.565731823f, 0.824589312f, 0.745057762f, 0.666999936f, 0.110222206f, 0.993906975f, -0.580813944f, 0.81403631f, 0.740951121f, 0.671558976f, 0.098017141f, 0.99518472f, -0.59569931f, 0.803207517f, 0.736816585f, 0.676092684f, 0.08579731f, 0.996312618f, -0.610382795f, 0.792106569f, 0.732654274f, 0.680601001f, 0.073564567f, 0.997290432f, -0.624859512f, 0.780737221f, 0.728464365f, 0.685083687f, 0.061320737f, 0.998118103f, -0.639124453f, 0.769103348f, 0.724247098f, 0.689540565f, 0.049067672f, 0.99879545f, -0.653172851f, 0.757208824f, 0.720002532f, 0.693971455f, 0.036807224f, 0.999322355f, -0.666999936f, 0.745057762f, 0.715730846f, 0.698376238f, 0.024541229f, 0.999698818f, -0.680601001f, 0.732654274f, 0.711432219f, 0.702754736f, 0.012271538f, 0.999924719f, -0.693971455f, 0.720002532f, 0.707106769f, 0.707106769f, -2.05E-10f, 1.0f, -0.707106769f, 0.707106769f, 0.702754736f, 0.711432219f, -0.012271538f, 0.999924719f, -0.720002532f, 0.693971455f, 0.698376238f, 0.715730846f, -0.024541229f, 0.999698818f, -0.732654274f, 0.680601001f, 0.693971455f, 0.720002532f, -0.036807224f, 0.999322355f, -0.745057762f, 0.666999936f, 0.689540565f, 0.724247098f, -0.049067676f, 0.99879545f, -0.757208824f, 0.653172851f, 0.685083687f, 0.728464365f, -0.061320737f, 0.998118103f, -0.769103348f, 0.639124453f, 0.680601001f, 0.732654274f, -0.073564567f, 0.997290432f, -0.780737221f, 0.624859512f, 0.676092684f, 0.736816585f, -0.08579731f, 0.996312618f, -0.792106569f, 0.610382795f, 0.671558976f, 0.740951121f, -0.098017141f, 0.99518472f, -0.803207517f, 0.59569931f, 0.666999936f, 0.745057762f, -0.110222206f, 0.993906975f, -0.81403631f, 0.580813944f, 0.662415802f, 0.749136388f, -0.122410677f, 0.992479563f, -0.824589312f, 0.565731823f, 0.657806695f, 0.753186822f, -0.134580702f, 0.990902662f, -0.834862888f, 0.550457954f, 0.653172851f, 0.757208824f, -0.146730468f, 0.989176512f, -0.84485358f, 0.534997642f, 0.64851439f, 0.761202395f, -0.15885815f, 0.987301409f, -0.854557991f, 0.519356012f, 0.643831551f, 0.765167236f, -0.170961887f, 0.985277653f, -0.863972843f, 0.50353837f, 0.639124453f, 0.769103348f, -0.183039889f, 0.983105481f, -0.873094976f, 0.487550169f, 0.634393275f, 0.773010433f, -0.195090324f, 0.980785251f, -0.881921291f, 0.471396744f, 0.629638255f, 0.77688849f, -0.207111374f, 0.97831738f, -0.890448749f, 0.455083579f, 0.624859512f, 0.780737221f, -0.219101235f, 0.975702107f, -0.898674488f, 0.438616246f, 0.620057225f, 0.784556568f, -0.231058106f, 0.972939968f, -0.906595707f, 0.422000259f, 0.615231574f, 0.78834641f, -0.242980182f, 0.970031261f, -0.914209783f, 0.405241311f, 0.610382795f, 0.792106569f, -0.254865646f, 0.966976464f, -0.921514034f, 0.388345033f, 0.605511069f, 0.795836926f, -0.266712755f, 0.963776052f, -0.928506076f, 0.371317208f, 0.600616455f, 0.799537241f, -0.27851969f, 0.960430503f, -0.935183525f, 0.354163527f, 0.59569931f, 0.803207517f, -0.290284663f, 0.956940353f, -0.941544056f, 0.336889863f, 0.590759695f, 0.806847572f, -0.302005947f, 0.953306019f, -0.947585583f, 0.319502026f, 0.585797846f, 0.81045717f, -0.313681751f, 0.949528158f, -0.953306019f, 0.302005947f, 0.580813944f, 0.81403631f, -0.32531029f, 0.945607305f, -0.958703458f, 0.284407526f, 0.575808167f, 0.817584813f, -0.336889863f, 0.941544056f, -0.963776052f, 0.266712755f, 0.570780754f, 0.8211025f, -0.348418683f, 0.937339008f, -0.968522072f, 0.248927608f, 0.565731823f, 0.824589312f, -0.359895051f, 0.932992816f, -0.972939968f, 0.231058106f, 0.560661554f, 0.82804507f, -0.371317208f, 0.928506076f, -0.977028131f, 0.213110313f, 0.555570245f, 0.831469595f, -0.382683426f, 0.923879504f, -0.98078531f, 0.195090324f, 0.550457954f, 0.834862888f, -0.393992037f, 0.919113874f, -0.984210074f, 0.177004218f, 0.545324981f, 0.838224709f, -0.405241311f, 0.914209783f, -0.987301409f, 0.15885815f, 0.540171444f, 0.841554999f, -0.416429549f, 0.909168005f, -0.990058184f, 0.140658244f, 0.534997642f, 0.84485358f, -0.427555084f, 0.903989315f, -0.992479563f, 0.122410677f, 0.529803634f, 0.848120332f, -0.438616246f, 0.898674488f, -0.994564593f, 0.104121633f, 0.524589658f, 0.851355195f, -0.449611336f, 0.893224299f, -0.996312618f, 0.08579731f, 0.519356012f, 0.854557991f, -0.460538715f, 0.887639642f, -0.997723043f, 0.067443922f, 0.514102757f, 0.857728601f, -0.471396744f, 0.881921291f, -0.99879545f, 0.049067672f, 0.50883013f, 0.860866964f, -0.482183784f, 0.876070082f, -0.999529421f, 0.030674802f, 0.50353837f, 0.863972843f, -0.492898196f, 0.870086968f, -0.999924719f, 0.012271537f, 0.498227656f, 0.867046237f, -0.50353837f, 0.863972843f, -0.999981165f, -0.006135885f, 0.492898196f, 0.870086968f, -0.514102757f, 0.857728601f, -0.999698818f, -0.024541229f, 0.487550169f, 0.873094976f, -0.524589658f, 0.851355195f, -0.999077737f, -0.042938259f, 0.482183784f, 0.876070082f, -0.534997642f, 0.84485358f, -0.998118103f, -0.061320737f, 0.47679922f, 0.879012227f, -0.545324981f, 0.838224709f, -0.996820271f, -0.07968244f, 0.471396744f, 0.881921291f, -0.555570245f, 0.831469595f, -0.99518472f, -0.098017141f, 0.465976506f, 0.884797096f, -0.565731823f, 0.824589312f, -0.993211925f, -0.116318628f, 0.460538715f, 0.887639642f, -0.575808167f, 0.817584813f, -0.990902662f, -0.134580702f, 0.455083579f, 0.890448749f, -0.585797846f, 0.81045717f, -0.988257587f, -0.152797192f, 0.449611336f, 0.893224299f, -0.59569931f, 0.803207517f, -0.985277653f, -0.170961887f, 0.444122136f, 0.895966232f, -0.605511069f, 0.795836926f, -0.981963873f, -0.18906866f, 0.438616246f, 0.898674488f, -0.615231574f, 0.78834641f, -0.97831738f, -0.207111374f, 0.433093816f, 0.901348829f, -0.624859512f, 0.780737221f, -0.974339366f, -0.225083917f, 0.427555084f, 0.903989315f, -0.634393275f, 0.773010433f, -0.970031261f, -0.242980182f, 0.422000259f, 0.906595707f, -0.643831551f, 0.765167236f, -0.965394437f, -0.260794133f, 0.416429549f, 0.909168005f, -0.653172851f, 0.757208824f, -0.960430503f, -0.27851969f, 0.410843164f, 0.91170603f, -0.662415802f, 0.749136388f, -0.955141187f, -0.296150893f, 0.405241311f, 0.914209783f, -0.671558976f, 0.740951121f, -0.949528158f, -0.313681751f, 0.399624199f, 0.916679084f, -0.680601001f, 0.732654274f, -0.943593442f, -0.331106305f, 0.393992037f, 0.919113874f, -0.689540565f, 0.724247098f, -0.937339008f, -0.348418683f, 0.388345033f, 0.921514034f, -0.698376238f, 0.715730846f, -0.93076694f, -0.365612984f, 0.382683426f, 0.923879504f, -0.707106769f, 0.707106769f, -0.923879504f, -0.382683426f, 0.377007425f, 0.926210225f, -0.715730846f, 0.698376238f, -0.916679084f, -0.399624199f, 0.371317208f, 0.928506076f, -0.724247098f, 0.689540565f, -0.909168005f, -0.416429549f, 0.365612984f, 0.93076694f, -0.732654274f, 0.680601001f, -0.901348829f, -0.433093816f, 0.359895051f, 0.932992816f, -0.740951121f, 0.671558976f, -0.893224299f, -0.449611336f, 0.354163527f, 0.935183525f, -0.749136388f, 0.662415802f, -0.884797096f, -0.465976506f, 0.348418683f, 0.937339008f, -0.757208824f, 0.653172851f, -0.876070082f, -0.482183784f, 0.342660725f, 0.939459205f, -0.765167236f, 0.643831551f, -0.867046237f, -0.498227656f, 0.336889863f, 0.941544056f, -0.773010433f, 0.634393275f, -0.857728601f, -0.514102757f, 0.331106305f, 0.943593442f, -0.780737221f, 0.624859512f, -0.848120332f, -0.529803634f, 0.32531029f, 0.945607305f, -0.78834641f, 0.615231574f, -0.838224709f, -0.545324981f, 0.319502026f, 0.947585583f, -0.795836926f, 0.605511069f, -0.82804507f, -0.560661554f, 0.313681751f, 0.949528158f, -0.803207517f, 0.59569931f, -0.817584813f, -0.575808167f, 0.307849646f, 0.95143503f, -0.81045717f, 0.585797846f, -0.806847572f, -0.590759695f, 0.302005947f, 0.953306019f, -0.817584813f, 0.575808167f, -0.795836926f, -0.605511069f, 0.296150893f, 0.955141187f, -0.824589312f, 0.565731823f, -0.784556568f, -0.620057225f, 0.290284663f, 0.956940353f, -0.831469595f, 0.555570245f, -0.773010433f, -0.634393275f, 0.284407526f, 0.958703458f, -0.838224709f, 0.545324981f, -0.761202395f, -0.64851439f, 0.27851969f, 0.960430503f, -0.84485358f, 0.534997642f, -0.749136388f, -0.662415802f, 0.272621363f, 0.962121427f, -0.851355195f, 0.524589658f, -0.736816585f, -0.676092684f, 0.266712755f, 0.963776052f, -0.857728601f, 0.514102757f, -0.724247098f, -0.689540565f, 0.260794103f, 0.965394437f, -0.863972843f, 0.50353837f, -0.711432219f, -0.702754736f, 0.254865646f, 0.966976464f, -0.870086968f, 0.492898196f, -0.698376238f, -0.715730846f, 0.248927608f, 0.968522072f, -0.876070082f, 0.482183784f, -0.685083687f, -0.728464365f, 0.242980182f, 0.970031261f, -0.881921291f, 0.471396744f, -0.671558976f, -0.740951121f, 0.237023607f, 0.971503913f, -0.887639642f, 0.460538715f, -0.657806695f, -0.753186822f, 0.231058106f, 0.972939968f, -0.893224299f, 0.449611336f, -0.643831551f, -0.765167236f, 0.225083917f, 0.974339366f, -0.898674488f, 0.438616246f, -0.629638255f, -0.77688849f, 0.219101235f, 0.975702107f, -0.903989315f, 0.427555084f, -0.615231574f, -0.78834641f, 0.213110313f, 0.977028131f, -0.909168005f, 0.416429549f, -0.600616455f, -0.799537241f, 0.207111374f, 0.97831738f, -0.914209783f, 0.405241311f, -0.585797846f, -0.81045717f, 0.201104641f, 0.979569793f, -0.919113874f, 0.393992037f, -0.570780754f, -0.8211025f, 0.195090324f, 0.980785251f, -0.923879504f, 0.382683426f, -0.555570245f, -0.831469595f, 0.18906866f, 0.981963873f, -0.928506076f, 0.371317208f, -0.540171444f, -0.841554999f, 0.183039889f, 0.983105481f, -0.932992816f, 0.359895051f, -0.524589658f, -0.851355195f, 0.177004218f, 0.984210074f, -0.937339008f, 0.348418683f, -0.50883013f, -0.860866964f, 0.170961887f, 0.985277653f, -0.941544056f, 0.336889863f, -0.492898196f, -0.870086968f, 0.164913118f, 0.986308098f, -0.945607305f, 0.32531029f, -0.47679922f, -0.879012227f, 0.15885815f, 0.987301409f, -0.949528158f, 0.313681751f, -0.460538715f, -0.887639642f, 0.152797192f, 0.988257587f, -0.953306019f, 0.302005947f, -0.444122136f, -0.895966232f, 0.146730468f, 0.989176512f, -0.956940353f, 0.290284663f, -0.427555084f, -0.903989315f, 0.140658244f, 0.990058184f, -0.960430503f, 0.27851969f, -0.410843164f, -0.91170603f, 0.134580702f, 0.990902662f, -0.963776052f, 0.266712755f, -0.393992037f, -0.919113874f, 0.128498107f, 0.991709769f, -0.966976464f, 0.254865646f, -0.377007395f, -0.926210225f, 0.122410677f, 0.992479563f, -0.970031261f, 0.242980182f, -0.359895051f, -0.932992816f, 0.116318628f, 0.993211925f, -0.972939968f, 0.231058106f, -0.342660725f, -0.939459205f, 0.110222206f, 0.993906975f, -0.975702107f, 0.219101235f, -0.32531029f, -0.945607305f, 0.104121633f, 0.994564593f, -0.97831738f, 0.207111374f, -0.307849646f, -0.95143503f, 0.098017141f, 0.99518472f, -0.98078531f, 0.195090324f, -0.290284663f, -0.956940353f, 0.091908954f, 0.995767415f, -0.983105481f, 0.183039889f, -0.272621363f, -0.962121427f, 0.08579731f, 0.996312618f, -0.985277653f, 0.170961887f, -0.254865646f, -0.966976464f, 0.07968244f, 0.996820271f, -0.987301409f, 0.15885815f, -0.237023607f, -0.971503913f, 0.073564567f, 0.997290432f, -0.989176512f, 0.146730468f, -0.219101235f, -0.975702107f, 0.067443922f, 0.997723043f, -0.990902662f, 0.134580702f, -0.201104641f, -0.979569793f, 0.061320737f, 0.998118103f, -0.992479563f, 0.122410677f, -0.183039889f, -0.983105481f, 0.055195246f, 0.998475552f, -0.993906975f, 0.110222206f, -0.164913118f, -0.986308098f, 0.049067672f, 0.99879545f, -0.99518472f, 0.098017141f, -0.146730468f, -0.989176512f, 0.042938259f, 0.999077737f, -0.996312618f, 0.08579731f, -0.128498107f, -0.991709769f, 0.036807224f, 0.999322355f, -0.997290432f, 0.073564567f, -0.110222206f, -0.993906975f, 0.030674802f, 0.999529421f, -0.998118103f, 0.061320737f, -0.091908954f, -0.995767415f, 0.024541229f, 0.999698818f, -0.99879545f, 0.049067672f, -0.073564567f, -0.997290432f, 0.01840673f, 0.999830604f, -0.999322414f, 0.036807224f, -0.055195242f, -0.998475552f, 0.012271538f, 0.999924719f, -0.999698818f, 0.024541229f, -0.036807224f, -0.999322414f, 0.006135885f, 0.999981165f, -0.999924719f, 0.012271537f, -0.01840673f, -0.999830604f, 1.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 0.999698818f, 0.024541229f, 0.99879545f, 0.049067676f, 0.997290432f, 0.073564567f, 0.99879545f, 0.049067676f, 0.99518472f, 0.098017141f, 0.989176512f, 0.146730468f, 0.997290432f, 0.073564567f, 0.989176512f, 0.146730468f, 0.975702107f, 0.219101235f, 0.99518472f, 0.098017141f, 0.980785251f, 0.195090324f, 0.956940353f, 0.290284663f, 0.992479563f, 0.122410677f, 0.970031261f, 0.242980182f, 0.932992816f, 0.359895051f, 0.989176512f, 0.146730468f, 0.956940353f, 0.290284663f, 0.903989315f, 0.427555084f, 0.985277653f, 0.170961887f, 0.941544056f, 0.336889863f, 0.870086968f, 0.492898196f, 0.980785251f, 0.195090324f, 0.923879504f, 0.382683426f, 0.831469595f, 0.555570245f, 0.975702107f, 0.219101235f, 0.903989315f, 0.427555084f, 0.78834641f, 0.615231574f, 0.970031261f, 0.242980182f, 0.881921291f, 0.471396744f, 0.740951121f, 0.671558976f, 0.963776052f, 0.266712755f, 0.857728601f, 0.514102757f, 0.689540565f, 0.724247098f, 0.956940353f, 0.290284663f, 0.831469595f, 0.555570245f, 0.634393275f, 0.773010433f, 0.949528158f, 0.313681751f, 0.803207517f, 0.59569931f, 0.575808167f, 0.817584813f, 0.941544056f, 0.336889863f, 0.773010433f, 0.634393275f, 0.514102757f, 0.857728601f, 0.932992816f, 0.359895051f, 0.740951121f, 0.671558976f, 0.449611336f, 0.893224299f, 0.923879504f, 0.382683426f, 0.707106769f, 0.707106769f, 0.382683426f, 0.923879504f, 0.914209783f, 0.405241311f, 0.671558976f, 0.740951121f, 0.313681751f, 0.949528158f, 0.903989315f, 0.427555084f, 0.634393275f, 0.773010433f, 0.242980182f, 0.970031261f, 0.893224299f, 0.449611336f, 0.59569931f, 0.803207517f, 0.170961887f, 0.985277653f, 0.881921291f, 0.471396744f, 0.555570245f, 0.831469595f, 0.098017141f, 0.99518472f, 0.870086968f, 0.492898196f, 0.514102757f, 0.857728601f, 0.024541229f, 0.999698818f, 0.857728601f, 0.514102757f, 0.471396744f, 0.881921291f, -0.049067676f, 0.99879545f, 0.84485358f, 0.534997642f, 0.427555084f, 0.903989315f, -0.122410677f, 0.992479563f, 0.831469595f, 0.555570245f, 0.382683426f, 0.923879504f, -0.195090324f, 0.980785251f, 0.817584813f, 0.575808167f, 0.336889863f, 0.941544056f, -0.266712755f, 0.963776052f, 0.803207517f, 0.59569931f, 0.290284663f, 0.956940353f, -0.336889863f, 0.941544056f, 0.78834641f, 0.615231574f, 0.242980182f, 0.970031261f, -0.405241311f, 0.914209783f, 0.773010433f, 0.634393275f, 0.195090324f, 0.980785251f, -0.471396744f, 0.881921291f, 0.757208824f, 0.653172851f, 0.146730468f, 0.989176512f, -0.534997642f, 0.84485358f, 0.740951121f, 0.671558976f, 0.098017141f, 0.99518472f, -0.59569931f, 0.803207517f, 0.724247098f, 0.689540565f, 0.049067672f, 0.99879545f, -0.653172851f, 0.757208824f, 0.707106769f, 0.707106769f, -2.05E-10f, 1.0f, -0.707106769f, 0.707106769f, 0.689540565f, 0.724247098f, -0.049067676f, 0.99879545f, -0.757208824f, 0.653172851f, 0.671558976f, 0.740951121f, -0.098017141f, 0.99518472f, -0.803207517f, 0.59569931f, 0.653172851f, 0.757208824f, -0.146730468f, 0.989176512f, -0.84485358f, 0.534997642f, 0.634393275f, 0.773010433f, -0.195090324f, 0.980785251f, -0.881921291f, 0.471396744f, 0.615231574f, 0.78834641f, -0.242980182f, 0.970031261f, -0.914209783f, 0.405241311f, 0.59569931f, 0.803207517f, -0.290284663f, 0.956940353f, -0.941544056f, 0.336889863f, 0.575808167f, 0.817584813f, -0.336889863f, 0.941544056f, -0.963776052f, 0.266712755f, 0.555570245f, 0.831469595f, -0.382683426f, 0.923879504f, -0.98078531f, 0.195090324f, 0.534997642f, 0.84485358f, -0.427555084f, 0.903989315f, -0.992479563f, 0.122410677f, 0.514102757f, 0.857728601f, -0.471396744f, 0.881921291f, -0.99879545f, 0.049067672f, 0.492898196f, 0.870086968f, -0.514102757f, 0.857728601f, -0.999698818f, -0.024541229f, 0.471396744f, 0.881921291f, -0.555570245f, 0.831469595f, -0.99518472f, -0.098017141f, 0.449611336f, 0.893224299f, -0.59569931f, 0.803207517f, -0.985277653f, -0.170961887f, 0.427555084f, 0.903989315f, -0.634393275f, 0.773010433f, -0.970031261f, -0.242980182f, 0.405241311f, 0.914209783f, -0.671558976f, 0.740951121f, -0.949528158f, -0.313681751f, 0.382683426f, 0.923879504f, -0.707106769f, 0.707106769f, -0.923879504f, -0.382683426f, 0.359895051f, 0.932992816f, -0.740951121f, 0.671558976f, -0.893224299f, -0.449611336f, 0.336889863f, 0.941544056f, -0.773010433f, 0.634393275f, -0.857728601f, -0.514102757f, 0.313681751f, 0.949528158f, -0.803207517f, 0.59569931f, -0.817584813f, -0.575808167f, 0.290284663f, 0.956940353f, -0.831469595f, 0.555570245f, -0.773010433f, -0.634393275f, 0.266712755f, 0.963776052f, -0.857728601f, 0.514102757f, -0.724247098f, -0.689540565f, 0.242980182f, 0.970031261f, -0.881921291f, 0.471396744f, -0.671558976f, -0.740951121f, 0.219101235f, 0.975702107f, -0.903989315f, 0.427555084f, -0.615231574f, -0.78834641f, 0.195090324f, 0.980785251f, -0.923879504f, 0.382683426f, -0.555570245f, -0.831469595f, 0.170961887f, 0.985277653f, -0.941544056f, 0.336889863f, -0.492898196f, -0.870086968f, 0.146730468f, 0.989176512f, -0.956940353f, 0.290284663f, -0.427555084f, -0.903989315f, 0.122410677f, 0.992479563f, -0.970031261f, 0.242980182f, -0.359895051f, -0.932992816f, 0.098017141f, 0.99518472f, -0.98078531f, 0.195090324f, -0.290284663f, -0.956940353f, 0.073564567f, 0.997290432f, -0.989176512f, 0.146730468f, -0.219101235f, -0.975702107f, 0.049067672f, 0.99879545f, -0.99518472f, 0.098017141f, -0.146730468f, -0.989176512f, 0.024541229f, 0.999698818f, -0.99879545f, 0.049067672f, -0.073564567f, -0.997290432f, 1.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 0.99518472f, 0.098017141f, 0.980785251f, 0.195090324f, 0.956940353f, 0.290284663f, 0.980785251f, 0.195090324f, 0.923879504f, 0.382683426f, 0.831469595f, 0.555570245f, 0.956940353f, 0.290284663f, 0.831469595f, 0.555570245f, 0.634393275f, 0.773010433f, 0.923879504f, 0.382683426f, 0.707106769f, 0.707106769f, 0.382683426f, 0.923879504f, 0.881921291f, 0.471396744f, 0.555570245f, 0.831469595f, 0.098017141f, 0.99518472f, 0.831469595f, 0.555570245f, 0.382683426f, 0.923879504f, -0.195090324f, 0.980785251f, 0.773010433f, 0.634393275f, 0.195090324f, 0.980785251f, -0.471396744f, 0.881921291f, 0.707106769f, 0.707106769f, -2.05E-10f, 1.0f, -0.707106769f, 0.707106769f, 0.634393275f, 0.773010433f, -0.195090324f, 0.980785251f, -0.881921291f, 0.471396744f, 0.555570245f, 0.831469595f, -0.382683426f, 0.923879504f, -0.98078531f, 0.195090324f, 0.471396744f, 0.881921291f, -0.555570245f, 0.831469595f, -0.99518472f, -0.098017141f, 0.382683426f, 0.923879504f, -0.707106769f, 0.707106769f, -0.923879504f, -0.382683426f, 0.290284663f, 0.956940353f, -0.831469595f, 0.555570245f, -0.773010433f, -0.634393275f, 0.195090324f, 0.980785251f, -0.923879504f, 0.382683426f, -0.555570245f, -0.831469595f, 0.098017141f, 0.99518472f, -0.98078531f, 0.195090324f, -0.290284663f, -0.956940353f, 1.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 0.923879504f, 0.382683426f, 0.707106769f, 0.707106769f, 0.382683426f, 0.923879504f, 0.707106769f, 0.707106769f, -2.05E-10f, 1.0f, -0.707106769f, 0.707106769f, 0.382683426f, 0.923879504f, -0.707106769f, 0.707106769f, -0.923879504f, -0.382683426f, 1.0f, 0.0f, 1.0f, 0.0f, 1.0f, 0.0f, 0.0f, 0.0f };
short mic1[FFT_SIZE] = { 0 };
short mic2[FFT_SIZE] = { 0 };
short hismic1[FFT_SIZE] = { 0 };
short hismic2[FFT_SIZE] = { 0 };
float frame[(FFT_SIZE - NN)] = { 0 };
short mict1[NN] = { 0 };
short mict2[NN] = { 0 };


void SignalDFT(const short*  in, float *out, const short FFTLen, const short FrameLen, int channel)
{
	float mic_f[FFT_SIZE] = { 0 };
	float time_data0[FFT_SIZE * 2] = { 0 };
	float sig1[FFT_SIZE];
	int i;
	if (channel == 1)
	{
		memcpy(&mic1[FFTLen - FrameLen], in, sizeof(short) * FrameLen);
		memcpy(mic1, &hismic1[FrameLen], sizeof(short) * (FFTLen - FrameLen));
		memcpy(hismic1, mic1, sizeof(short) * FFTLen);
		for (int i = 0; i < FFTLen; ++i) {
			mic_f[i] = (float)(mic1[i] * 1.0 / 32768.0);
		}
	}
	else
	{
		memcpy(&mic2[FFTLen - FrameLen], in, sizeof(short) * FrameLen);
		memcpy(mic2, &hismic2[FrameLen], sizeof(short) * (FFTLen - FrameLen));
		memcpy(hismic2, mic2, sizeof(short) * FFTLen);
		for (int i = 0; i < FFTLen; ++i) {
			mic_f[i] = (float)(mic2[i] * 1.0 / 32768.0);
		}
	}
		
	DSPF_sp_vecmul(mic_f, kBlockswin, sig1, FFTLen);
	for (i = 0; i<FFTLen; ++i) {
		time_data0[2 * i] = sig1[i];
		time_data0[2 * i + 1] = 0;
	}
	DSPF_sp_fftSPxSP(FFTLen, time_data0, Cwns, out, brev, 4, 0, FFTLen);
}

void SignalIDFT(const float *in, short* /*float**/ out, const short FFTLen, const short FrameLen)
{
	int i;
	float time_data1[FFT_SIZE * 2] = { 0 };
	float out_sig[FFT_SIZE] = { 0 };
	
	DSPF_sp_ifftSPxSP(FFTLen, in, Cwns, time_data1, brev, 4, 0, FFTLen);
	for (i = 0; i<FFTLen; i++) {   //»°µ√256∏ˆ µ ˝ ±”Ú–≈∫≈—˘µ„
		out_sig[i] = time_data1[2 * i];
	}

	DSPF_sp_vecmul(out_sig, kBlockswin, out_sig, FFTLen);
	DSPF_sp_w_vec(out_sig, frame, 1, out_sig, (FFTLen - FrameLen));
	memcpy(frame, out_sig + FrameLen, sizeof(float) * (FFTLen - FrameLen));
	for (i = 0; i < FrameLen; i++) {
		out[i] = (short)(out_sig[i] * 32768);
	}
}


//À„∑®µƒ≥£ ˝≤Œ ˝
#define nchan  2    //À´Õ®µ¿ 
#define alfa  0.5  // smoothing constant
#define Td   0.05  // ‘¥–≈∫≈√ª”–œ‘÷¯◊‘œ‡πÿœµ ˝µƒ ±º‰øÁ∂»£¨≥£¡ø50ms
#define T60   0.5
#define deta  (3*log(10)/(T60/Td)) // —”≥Ÿœµ ˝ decay constant 
#define p  0.5 // p norm
#define coff1  exp(-2 * deta)
#define ND  4
#define tau  2
#define  alfa_1  (1 - alfa)
#define eps_1  1e-30
#define Lg 30
#define gamma 0.94

//¥∞∫Ø ˝œ‡πÿ
#define wlen 1024
#define overlapping  (wlen/2)
#define nbin  (wlen/2+1)
#define Maxfram 10000

//À„∑®µƒ±‰¡ø≤Œ ˝
double sigema_d[nbin][Maxfram][nchan] = { 0 };  // µ ˝
double sigema_x[nbin][Maxfram][nchan] = { 0 };  // µ ˝
double sigema_r[nbin][Maxfram][nchan] = { 0 };  // µ ˝
double w_2[nbin][Maxfram] = { 0 };  // µ ˝
mc processed_spec[nbin][Maxfram][nchan];   //–È ˝
double J[nbin][Maxfram] = { 0 };
double e[nbin][Maxfram] = { 0 };     // µ ˝
double e_w[nbin][Maxfram] = { 0 };   // µ ˝
mc R_qr_MLg[Lg * nchan][Lg * nchan];
mc d_qr_M[Lg * nchan][nchan];

mc X_history[nbin][Lg+tau][nchan];  //¥Ê¥¢«∞32÷°µƒ¿˙ ∑ ˝æ›  –È ˝


mc G_hat_total[nchan * Lg][nchan][nbin];  //–È ˝
mc D_total[Lg * nchan + 1][ Lg * nchan + nchan][nbin];  //–È ˝
void init()
{
	for (int i = 0; i < nbin; i++)
		for (int j = 0; j < Lg * nchan + 1; j++)
			cnew(&D_total[j][j][i],100,0);
	//∆‰À˚µƒ∂º≥ı ºªØŒ™0
	memset(processed_spec, 0, sizeof(processed_spec));
	memset(R_qr_MLg, 0, sizeof(R_qr_MLg));
	memset(d_qr_M, 0, sizeof(d_qr_M));
	memset(X_history, 0, sizeof(X_history));
	memset(G_hat_total, 0, sizeof(G_hat_total));	
}



void qrgv_1(mc R[Lg * nchan + 1][Lg * nchan + nchan], mc A[Lg * nchan + 1][Lg * nchan + nchan][nbin], int k)
{
	for (int i = 0; i < Lg * nchan + 1; i++)
	{
		for (int j = 0; j < Lg * nchan + nchan; j++)
			R[i][j] = A[i][j][k];
	}
	for (int i = 0; i < Lg*nchan; i++)
	{
		mc givens[Lg * nchan+1][Lg * nchan+1];
		memset(givens, 0, sizeof(givens));
		for (int j = 0; j < Lg * nchan + 1; j++)
			cnew(&givens[j][j], 1, 0);
		//r = sqrt(abs(R(i,i))^2+abs(R(num+1,i))^2)+0.0000000001;
		double r = sqrt( pow(cmod(R[i][i]),2) +  pow(cmod(R[Lg*nchan][i]),2) ) + 0.0000000001;
		mc mcr; 
		cnew(&mcr, r, 0);
		mc cost = cdiv(R[i][i], mcr);
		mc sint = cdiv(R[Lg * nchan][i], mcr);
		givens[i][i] = ccon(cost);
		givens[i][Lg * nchan] = ccon(sint);
		givens[Lg * nchan][i] = cneg(sint);
		givens[Lg * nchan][Lg * nchan] = cost;
		//R = givens * R;
		mc temp[Lg * nchan + 1][Lg * nchan + nchan];
		memset(temp, 0, sizeof(temp));	
		
		for (int j = 0; j < Lg * nchan + 1; j++)
		{
			for (int s = 0; s < Lg * nchan + nchan; s++)
			{
				for (int t = 0; t < Lg * nchan + 1; t++)
				{
					temp[j][s] =cplus(temp[j][s], cpro(givens[j][t], R[t][s]));
				}
			}
		}
		memcpy(R, temp, sizeof(temp));

	}
}


void backsolution(mc x[nchan * Lg][nchan][nbin], mc A[Lg * nchan][Lg * nchan], mc b[Lg * nchan][nchan], int chan, int k)
{
	//«ÛΩ‚…œ»˝Ω«¿‡–Õµƒœﬂ–‘∑Ω≥Ã◊È
	int n = Lg * nchan;
	for (int i = 0; i < n; i++)
	{ 
		x[i][chan][k].re = 0;
		x[i][chan][k].im = 0;
	}
	x[n-1][chan][k] = cdiv(b[n-1][chan], A[n-1][n-1]);
	for (int i = n - 2; i >= 0; i--)
	{
		mc temp;
		cnew(&temp, 0, 0);
		for (int j = i + 1; j < n; j++)
		{
			temp = cplus(temp, cpro(A[i][j], x[j][chan][k]));
		}
		x[i][chan][k] = cdiv(cminus(b[i][chan], temp), A[i][i]);
	}
		
}

int FFTWinTestW(char *infileleft, char *outfilename)
{
	short mic1_s[FRAMEL] = { 0 };
	short mic2_s[FRAMEL] = { 0 };
	short mic_temp[FRAMEL * 2] = { 0 };   //PCM «¡Ω∏ˆÕ®µ¿ΩªÃÊ¥Ê¥¢ ˝æ›µ„
	short out_frame[NN];
	short out_frameN1[FRAMEL], out_frameN2[FRAMEL];
	short out_frameN[FRAMEL * 2];            //PCM «¡Ω∏ˆÕ®µ¿ΩªÃÊ¥Ê¥¢ ˝æ›µ„
	float sigArray1[FFT_SIZE * 2] = { 0 };
	float sigArray2[FFT_SIZE * 2] = { 0 };
	int  ch1filter_state1[6], ch1filter_state12[6];
	int  ch2filter_state1[6], ch2filter_state12[6];
	int  ch1Synthesis_state1[6], ch1Synthesis_state12[6];
	int  ch2Synthesis_state1[6], ch2Synthesis_state12[6];
	short shInL1[NN2], shInH1[NN2], shInL2[NN2], shInH2[NN2];
	short shOutL1[NN2] = { 0 }, shOutH1[NN2] = { 0 }, shOutL2[NN2] = { 0 }, shOutH2[NN2] = { 0 };

	memset(ch1filter_state1, 0, sizeof(ch1filter_state1));
	memset(ch1filter_state12, 0, sizeof(ch1filter_state12));
	memset(ch1Synthesis_state1, 0, sizeof(ch1Synthesis_state1));
	memset(ch1Synthesis_state12, 0, sizeof(ch1Synthesis_state12));
	memset(ch2filter_state1, 0, sizeof(ch2filter_state1));
	memset(ch2filter_state12, 0, sizeof(ch2filter_state12));
	memset(ch2Synthesis_state1, 0, sizeof(ch2Synthesis_state1));
	memset(ch2Synthesis_state12, 0, sizeof(ch2Synthesis_state12));

	int curframe = 0; //µ±«∞¥¶¿ÌµΩ∂‡…Ÿ÷°

	FILE *fp_m1 = fopen(infileleft, "rb");
	FILE *fp_out = fopen(outfilename, "wb");
	init();
	printf("≥…π¶≥ı ºªØ£°\n");

	do
	{
		if (!fp_m1 || !fp_out)
		{
			printf("File open err. \n");
			break;
		}

		while (1)
		{
			
			
			if (FRAMEL*2 == fread(mic_temp, sizeof(short), FRAMEL*2, fp_m1))
			{
				for (int i = 0; i < FRAMEL; i++)
				{
					mic1_s[i] = mic_temp[i*2];
					mic2_s[i] = mic_temp[i*2 +1];
				}
		 		  		
				InnoTalkSpl_AnalysisQMF(mic1_s, shInL1, shInH1, ch1filter_state1, ch1filter_state12);
				SignalDFT(shInL1, sigArray1, FFT_SIZE, NN, 1);
				InnoTalkSpl_AnalysisQMF(mic2_s, shInL2, shInH2, ch2filter_state1, ch2filter_state12);
				SignalDFT(shInL2, sigArray2, FFT_SIZE, NN, 2);
				
				
				//»°«∞nbin∏ˆµ„£®513£©
				for (int k = 0; k < nbin; k++)
				{ 
					mc mcl[nchan]; //∂®“Â–È ˝±‰¡ø¥Ê∑≈¡ΩÕ®µ¿ ˝æ›
					cnew(&mcl[0], sigArray1[2 * k], sigArray1[2 * k + 1]);
					cnew(&mcl[1], sigArray2[2 * k], sigArray2[2 * k + 1]);
					//∏¸–¬«∞32÷° ˝◊È
					for (int i = 0; i < Lg + tau - 1; i++)
					{
						X_history[k][i][0] = X_history[k][i + 1][0];
						X_history[k][i][1] = X_history[k][i + 1][1];
					}
					X_history[k][Lg + tau - 1][0] = mcl[0];
					X_history[k][Lg + tau - 1][1] = mcl[1];
					
					//À„∑®≤ø∑÷	
					if (curframe >=  ND)   //MATLAB’‚¿Ô «ND+1
					{
						double x_abs_2[2];
						for (int j = 0; j < nchan; j++)
						{
							x_abs_2[j] = pow(cmod(mcl[j]),2);  //’‚¿Ô « µ ˝
							sigema_x[k][curframe][j] = alfa * sigema_x[k][curframe - 1][j] + alfa_1 * x_abs_2[j];
							sigema_r[k][curframe][j] = coff1 * sigema_x[k][curframe-ND][j];
							sigema_d[k][curframe][j] = alfa * sigema_d[k][curframe-1][j] + alfa_1 * max((x_abs_2[j] - sigema_r[k][curframe][j]), 0);
						}
						w_2[k][curframe] = pow((pow(sigema_d[k][curframe][0], 2) + pow(sigema_d[k][curframe][1], 2)) / nchan + eps_1, p / 2 - 1);
					}
					
					if (curframe <= Lg + tau - 2)  //MATLAB’‚¿Ô «Lg + tau - 1
					{
						for (int j = 0; j < nchan; j++)
						{
							processed_spec[k][curframe][j] = mcl[j];
						}
						//¥˙º€∫Ø ˝≥ı ºªØ
						e[k][curframe] = pow(cmod(mcl[0]), 2) + pow(cmod(mcl[1]), 2);
						e_w[k][curframe] = w_2[k][curframe] * e[k][curframe];
						if (curframe == 0) //MATLAB’‚¿Ô «1
							J[k][curframe] = e_w[k][curframe];
						else
							J[k][curframe] = J[k][curframe-1] + e_w[k][curframe];
					}
					else
					{
						for (int i = 0; i < Lg; i++)
						{
							D_total[nchan * Lg][i][k].re = sqrt(w_2[k][curframe]) * X_history[k][i][0].re;						 
							D_total[nchan * Lg ][i][k].im = sqrt(w_2[k][curframe]) * X_history[k][i][0].im;
							D_total[nchan * Lg ][i+Lg][k].re = sqrt(w_2[k][curframe]) * X_history[k][i][1].re;
							D_total[nchan * Lg ][i+Lg][k].im = sqrt(w_2[k][curframe]) * X_history[k][i][1].im;
						}
						D_total[nchan * Lg ][Lg * nchan][k].re = sqrt(w_2[k][curframe]) * mcl[0].re;
						D_total[nchan * Lg ][Lg * nchan][k].im = sqrt(w_2[k][curframe]) * mcl[0].im;
						D_total[nchan * Lg ][Lg * nchan + 1][k].re = sqrt(w_2[k][curframe]) * mcl[1].re;
						D_total[nchan * Lg ][Lg * nchan + 1][k].im = sqrt(w_2[k][curframe]) * mcl[1].im;
						//Ω¯––QR∑÷Ω‚
						mc R_qr[Lg * nchan + 1][Lg * nchan + nchan];
						qrgv_1(R_qr, D_total, k);
						for (int i = 0; i < Lg * nchan; i++)
						{
							for (int j = 0; j < Lg * nchan; j++)
							{ 
								R_qr_MLg[i][j] = R_qr[i][j];
							}
						}
						for (int i = 0; i < Lg * nchan; i++)
						{
							for (int j = Lg * nchan; j < Lg * nchan + nchan; j++)
							{ 
								d_qr_M[i][j- Lg * nchan] = R_qr[i][j];
							}
						}
						for (int chan = 0; chan < nchan; chan++)
							backsolution(G_hat_total, R_qr_MLg, d_qr_M, chan, k);
						/*
						mc ttt[60][2];
						for (int i = 0; i < 60; i++)
						{
							ttt[i][0] = G_hat_total[i][0][k];
							ttt[i][1] = G_hat_total[i][1][k];
						}*/
						printf("%d %d\n", curframe, k);
						mc x_tau[Lg * nchan];
						for (int i = 0; i < Lg; i++)
						{
							x_tau[i].re = X_history[k][i][0].re;
							x_tau[i].im = X_history[k][i][0].im;
							x_tau[i + Lg].re =  X_history[k][i][1].re;
							x_tau[i + Lg].im =  X_history[k][i][1].im;
						}
						mc u[nchan], d[nchan];
						cnew(&u[0], 0, 0); cnew(&u[1], 0, 0);
						for (int i = 0; i < Lg * nchan; i++)
						{
							u[0] = cplus(u[0], cpro(G_hat_total[i][0][k], x_tau[i]));
							u[1] = cplus(u[1], cpro(G_hat_total[i][1][k], x_tau[i]));
						}
						d[0] = cminus(mcl[0], u[0]);
						d[1] = cminus(mcl[1], u[1]);
						processed_spec[k][curframe][0] = d[0];
						processed_spec[k][curframe][1] = d[1];
						for (int i = 0; i < Lg * nchan + 1; i++)
						{
							for (int j = 0; j < Lg * nchan + nchan; j++)
							{
								mc gg;
								cnew(&gg, sqrt(gamma), 0);
								D_total[i][j][k] = cpro(gg, R_qr[i][j]);
							}
						}
						e[k][curframe] = pow(cmod(d[0]), 2) + pow(cmod(d[1]), 2);
						e_w[k][curframe] = w_2[k][curframe] * e[k][curframe];
						J[k][curframe] = gamma * J[k][curframe - 1] + e_w[k][curframe];

						//–ﬁ∏ƒ‘≠Œƒº˛
						sigArray1[2 * k] = processed_spec[k][curframe][0].re;
						sigArray1[2 * k + 1] = processed_spec[k][curframe][0].im;
						sigArray2[2 * k] = processed_spec[k][curframe][1].re;
						sigArray2[2 * k + 1] = processed_spec[k][curframe][1].im;
						//∫Û∞Î≤ø∑÷∏¥π≤ÈÓ∆¥Ω”
						if (k >= 1 && k <= 511)  //¥”1~511∑¥œÚ∆¥Ω”
						{ 
							sigArray1[2 * (wlen - k)] = ccon(processed_spec[k][curframe][0]).re;
							sigArray1[2 * (wlen - k) + 1] = ccon(processed_spec[k][curframe][0]).im;
							sigArray2[2 * (wlen - k)] = ccon(processed_spec[k][curframe][1]).re;
							sigArray2[2 * (wlen - k) + 1] = ccon(processed_spec[k][curframe][1]).im;
						}
					}
				}
				

				SignalIDFT(sigArray1, shOutL1, FFT_SIZE, NN);
				InnoTalkSpl_SynthesisQMF(shInL1, mict1, out_frameN1, ch1Synthesis_state1, ch1Synthesis_state12);
				SignalIDFT(sigArray2, shOutL2, FFT_SIZE, NN);
				InnoTalkSpl_SynthesisQMF(shInL2, mict2, out_frameN2, ch2Synthesis_state1, ch2Synthesis_state12);
				memcpy(mict1, shInH1, sizeof(short)*NN);
				memcpy(mict2, shInH2, sizeof(short) * NN);
				for (int i = 0; i < FRAMEL; i++)
				{
					out_frameN[i*2] = out_frameN1[i];
					out_frameN[i*2+1] = out_frameN2[i];
				}
				fwrite(out_frameN, sizeof(short), FRAMEL*2, fp_out); 
				curframe++;  
				
			}
			else
			{
				break;
			}
		}
	} while (0);

	fclose(fp_m1);
	fclose(fp_out);
	return 0;
}

int _tmain()
{
	printf("Start...\n");
	// ‰≥ˆ«∞96∏ˆµ„Œ™0£¨≤ªƒ‹÷±Ω”∫Õ‘≠ º ˝æ›∂‘±»
	FFTWinTestW("RecordAudio32_4s.pcm", "RecordAudio32_4sN.pcm");
	printf("End...\n");

	getchar();
	return 0;
}
